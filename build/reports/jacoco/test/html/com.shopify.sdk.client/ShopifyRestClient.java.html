<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ShopifyRestClient.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">shopify-spring-sdk</a> &gt; <a href="index.source.html" class="el_package">com.shopify.sdk.client</a> &gt; <span class="el_source">ShopifyRestClient.java</span></div><h1>ShopifyRestClient.java</h1><pre class="source lang-java linenums">package com.shopify.sdk.client;

import com.fasterxml.jackson.databind.JsonNode;
import com.shopify.sdk.client.rest.RestClient;
import com.shopify.sdk.config.ShopifyAuthContext;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;
import reactor.core.publisher.Mono;

import java.util.Map;

/**
 * Shopify-specific REST client that provides convenient methods for REST API operations.
 */
<span class="fc" id="L16">@Slf4j</span>
@Component
<span class="nc" id="L18">@RequiredArgsConstructor</span>
public class ShopifyRestClient {
    
    private final RestClient restClient;
    private final ShopifyAuthContext context;
    
    /**
     * Makes a GET request to a Shopify REST endpoint.
     *
     * @param shop the shop domain
     * @param accessToken the access token
     * @param endpoint the API endpoint (e.g., &quot;/products.json&quot;)
     * @param queryParams optional query parameters
     * @return Mono of JsonNode response
     */
    public Mono&lt;JsonNode&gt; get(String shop, String accessToken, String endpoint, Map&lt;String, Object&gt; queryParams) {
<span class="nc" id="L34">        validateInputs(shop, accessToken, endpoint);</span>
<span class="nc" id="L35">        return restClient.get(shop, accessToken, endpoint, queryParams);</span>
    }
    
    /**
     * Makes a GET request to a Shopify REST endpoint without query parameters.
     *
     * @param shop the shop domain
     * @param accessToken the access token
     * @param endpoint the API endpoint
     * @return Mono of JsonNode response
     */
    public Mono&lt;JsonNode&gt; get(String shop, String accessToken, String endpoint) {
<span class="nc" id="L47">        return get(shop, accessToken, endpoint, null);</span>
    }
    
    /**
     * Makes a POST request to a Shopify REST endpoint.
     *
     * @param shop the shop domain
     * @param accessToken the access token
     * @param endpoint the API endpoint
     * @param body the request body
     * @return Mono of JsonNode response
     */
    public Mono&lt;JsonNode&gt; post(String shop, String accessToken, String endpoint, Object body) {
<span class="nc" id="L60">        validateInputs(shop, accessToken, endpoint);</span>
<span class="nc" id="L61">        return restClient.post(shop, accessToken, endpoint, body);</span>
    }
    
    /**
     * Makes a PUT request to a Shopify REST endpoint.
     *
     * @param shop the shop domain
     * @param accessToken the access token
     * @param endpoint the API endpoint
     * @param body the request body
     * @return Mono of JsonNode response
     */
    public Mono&lt;JsonNode&gt; put(String shop, String accessToken, String endpoint, Object body) {
<span class="nc" id="L74">        validateInputs(shop, accessToken, endpoint);</span>
<span class="nc" id="L75">        return restClient.put(shop, accessToken, endpoint, body);</span>
    }
    
    /**
     * Makes a DELETE request to a Shopify REST endpoint.
     *
     * @param shop the shop domain
     * @param accessToken the access token
     * @param endpoint the API endpoint
     * @return Mono of JsonNode response
     */
    public Mono&lt;JsonNode&gt; delete(String shop, String accessToken, String endpoint) {
<span class="nc" id="L87">        validateInputs(shop, accessToken, endpoint);</span>
<span class="nc" id="L88">        return restClient.delete(shop, accessToken, endpoint);</span>
    }
    
    /**
     * Gets all products using the REST API.
     *
     * @param shop the shop domain
     * @param accessToken the access token
     * @param limit the number of products to retrieve (max 250)
     * @param pageInfo pagination info for cursor-based pagination
     * @return Mono of JsonNode containing products
     */
    public Mono&lt;JsonNode&gt; getProducts(String shop, String accessToken, Integer limit, String pageInfo) {
<span class="nc" id="L101">        Map&lt;String, Object&gt; queryParams = Map.of(</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">            &quot;limit&quot;, limit != null ? Math.min(limit, 250) : 50</span>
        );
        
<span class="nc bnc" id="L105" title="All 4 branches missed.">        if (pageInfo != null &amp;&amp; !pageInfo.trim().isEmpty()) {</span>
<span class="nc" id="L106">            queryParams = Map.of(</span>
<span class="nc bnc" id="L107" title="All 2 branches missed.">                &quot;limit&quot;, limit != null ? Math.min(limit, 250) : 50,</span>
                &quot;page_info&quot;, pageInfo
            );
        }
        
<span class="nc" id="L112">        return get(shop, accessToken, &quot;/products.json&quot;, queryParams);</span>
    }
    
    /**
     * Gets a single product by ID using the REST API.
     *
     * @param shop the shop domain
     * @param accessToken the access token
     * @param productId the product ID
     * @return Mono of JsonNode containing the product
     */
    public Mono&lt;JsonNode&gt; getProduct(String shop, String accessToken, String productId) {
<span class="nc" id="L124">        return get(shop, accessToken, String.format(&quot;/products/%s.json&quot;, productId));</span>
    }
    
    /**
     * Gets all orders using the REST API.
     *
     * @param shop the shop domain
     * @param accessToken the access token
     * @param limit the number of orders to retrieve (max 250)
     * @param status the order status filter
     * @param pageInfo pagination info for cursor-based pagination
     * @return Mono of JsonNode containing orders
     */
    public Mono&lt;JsonNode&gt; getOrders(String shop, String accessToken, Integer limit, String status, String pageInfo) {
<span class="nc" id="L138">        Map&lt;String, Object&gt; queryParams = Map.of(</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">            &quot;limit&quot;, limit != null ? Math.min(limit, 250) : 50</span>
        );
        
<span class="nc bnc" id="L142" title="All 4 branches missed.">        if (status != null &amp;&amp; !status.trim().isEmpty()) {</span>
<span class="nc" id="L143">            queryParams = Map.of(</span>
<span class="nc bnc" id="L144" title="All 2 branches missed.">                &quot;limit&quot;, limit != null ? Math.min(limit, 250) : 50,</span>
                &quot;status&quot;, status
            );
        }
        
<span class="nc bnc" id="L149" title="All 4 branches missed.">        if (pageInfo != null &amp;&amp; !pageInfo.trim().isEmpty()) {</span>
<span class="nc bnc" id="L150" title="All 4 branches missed.">            if (status != null &amp;&amp; !status.trim().isEmpty()) {</span>
<span class="nc" id="L151">                queryParams = Map.of(</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">                    &quot;limit&quot;, limit != null ? Math.min(limit, 250) : 50,</span>
                    &quot;status&quot;, status,
                    &quot;page_info&quot;, pageInfo
                );
            } else {
<span class="nc" id="L157">                queryParams = Map.of(</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">                    &quot;limit&quot;, limit != null ? Math.min(limit, 250) : 50,</span>
                    &quot;page_info&quot;, pageInfo
                );
            }
        }
        
<span class="nc" id="L164">        return get(shop, accessToken, &quot;/orders.json&quot;, queryParams);</span>
    }
    
    /**
     * Gets a single order by ID using the REST API.
     *
     * @param shop the shop domain
     * @param accessToken the access token
     * @param orderId the order ID
     * @return Mono of JsonNode containing the order
     */
    public Mono&lt;JsonNode&gt; getOrder(String shop, String accessToken, String orderId) {
<span class="nc" id="L176">        return get(shop, accessToken, String.format(&quot;/orders/%s.json&quot;, orderId));</span>
    }
    
    /**
     * Creates a product using the REST API.
     *
     * @param shop the shop domain
     * @param accessToken the access token
     * @param productData the product data
     * @return Mono of JsonNode containing the created product
     */
    public Mono&lt;JsonNode&gt; createProduct(String shop, String accessToken, Object productData) {
<span class="nc" id="L188">        return post(shop, accessToken, &quot;/products.json&quot;, productData);</span>
    }
    
    /**
     * Updates a product using the REST API.
     *
     * @param shop the shop domain
     * @param accessToken the access token
     * @param productId the product ID
     * @param productData the updated product data
     * @return Mono of JsonNode containing the updated product
     */
    public Mono&lt;JsonNode&gt; updateProduct(String shop, String accessToken, String productId, Object productData) {
<span class="nc" id="L201">        return put(shop, accessToken, String.format(&quot;/products/%s.json&quot;, productId), productData);</span>
    }
    
    /**
     * Deletes a product using the REST API.
     *
     * @param shop the shop domain
     * @param accessToken the access token
     * @param productId the product ID
     * @return Mono of JsonNode response
     */
    public Mono&lt;JsonNode&gt; deleteProduct(String shop, String accessToken, String productId) {
<span class="nc" id="L213">        return delete(shop, accessToken, String.format(&quot;/products/%s.json&quot;, productId));</span>
    }
    
    private void validateInputs(String shop, String accessToken, String endpoint) {
<span class="nc bnc" id="L217" title="All 4 branches missed.">        if (shop == null || shop.trim().isEmpty()) {</span>
<span class="nc" id="L218">            throw new IllegalArgumentException(&quot;Shop domain cannot be null or empty&quot;);</span>
        }
<span class="nc bnc" id="L220" title="All 4 branches missed.">        if (accessToken == null || accessToken.trim().isEmpty()) {</span>
<span class="nc" id="L221">            throw new IllegalArgumentException(&quot;Access token cannot be null or empty&quot;);</span>
        }
<span class="nc bnc" id="L223" title="All 4 branches missed.">        if (endpoint == null || endpoint.trim().isEmpty()) {</span>
<span class="nc" id="L224">            throw new IllegalArgumentException(&quot;Endpoint cannot be null or empty&quot;);</span>
        }
<span class="nc" id="L226">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>